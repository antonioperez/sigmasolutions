$(document).ready(function(){function fix_height(){var heightWithoutNavbar=$("body > #wrapper").height()-61;$(".sidebar-panel").css("min-height",heightWithoutNavbar+"px");var navbarHeight=$("nav.navbar-default").height(),wrapperHeight=$("#page-wrapper").height();navbarHeight>wrapperHeight&&$("#page-wrapper").css("min-height",navbarHeight+"px"),wrapperHeight>navbarHeight&&$("#page-wrapper").css("min-height",$(window).height()+"px"),$("body").hasClass("fixed-nav")&&(navbarHeight>wrapperHeight?$("#page-wrapper").css("min-height",navbarHeight+"px"):$("#page-wrapper").css("min-height",$(window).height()-60+"px"))}$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||fix_height()}),$(window).scroll(function(){$(window).scrollTop()>0&&!$("body").hasClass("fixed-nav")?$("#right-sidebar").addClass("sidebar-top"):$("#right-sidebar").removeClass("sidebar-top")}),setTimeout(function(){fix_height()})}),$(window).bind("load resize",function(){$(document).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")}),function(){angular.module("app",["oc.lazyLoad","ui.router","ui.bootstrap"])}(),function(){function config($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/login"),$stateProvider.state("index",{"abstract":!0,url:"/index",templateUrl:"components/layout/content.html"})}angular.module("app").config(["$stateProvider","$urlRouterProvider",config]).run(["$rootScope","$state",function($rootScope,$state){$rootScope.$state=$state}])}(),function(){function pageTitle($rootScope,$timeout){return{link:function(scope,element){var listener=function(event,toState,toParams,fromState,fromParams){var title="SGMA Solutions | Ecoverse";toState.data&&toState.data.pageTitle&&(title="SGMA | "+toState.data.pageTitle),$timeout(function(){element.text(title)})};$rootScope.$on("$stateChangeStart",listener)}}}function sideNavigation($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.metisMenu()});var menuElement=$('#side-menu a:not([href$="\\#"])');if(menuElement.click(function(){$(window).width()<769&&$("body").toggleClass("mini-navbar")}),$("body").hasClass("fixed-sidebar")){var sidebar=element.parent();sidebar.slimScroll({height:"100%",railOpacity:.9})}}}}function iboxTools($timeout){return{restrict:"A",scope:!0,templateUrl:"components/layout/ibox_tools.html",controller:["$scope","$element",function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first"),content=ibox.children(".ibox-content");content.slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){var ibox=$element.closest("div.ibox");ibox.remove()}}]}}function minimalizaSidebar($timeout){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:["$scope","$element",function($scope,$element){$scope.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},200)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},100)):$("#side-menu").removeAttr("style")}}]}}function iboxToolsFullScreen($timeout){return{restrict:"A",scope:!0,templateUrl:"components/layout/ibox_tools_full_screen.html",controller:["$scope","$element",function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first"),content=ibox.children(".ibox-content");content.slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){var ibox=$element.closest("div.ibox");ibox.remove()},$scope.fullscreen=function(){var ibox=$element.closest("div.ibox"),button=$element.find("i.fa-expand");$("body").toggleClass("fullscreen-ibox-mode"),button.toggleClass("fa-expand").toggleClass("fa-compress"),ibox.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}}]}}angular.module("app").directive("pageTitle",["$rootScope","$timeout",pageTitle]).directive("sideNavigation",["$timeout",sideNavigation]).directive("iboxTools",["$timeout",iboxTools]).directive("minimalizaSidebar",["$timeout",minimalizaSidebar]).directive("iboxToolsFullScreen",["$timeout",iboxToolsFullScreen])}(),function(){function MainCtrl(){var vm=this;vm.userName="Jon Snow"}angular.module("app").controller("MainCtrl",MainCtrl)}(),function(){angular.module("app").service("mapservice",function($http){var self=this,CONVERTER_URL="http://sgma.ecoverse.io/mapper/convertJson";self.generateMap=function(mapId,zoom,zipPath,backgroundOptions,popupContent,searchKey,addDrawingOptions,customFeatureCallback){$("#"+mapId).css("width","100%"),$("#"+mapId).css("height","500px");var map=L.map(mapId).setView([36.8,-120],zoom),options=(L.esri.basemapLayer("Topographic").addTo(map),{searchKey:searchKey,addDrawingOptions:addDrawingOptions,backgroundOverlayStyle:backgroundOptions,popupContent:popupContent,customFeatureCallback:customFeatureCallback});return map=self.loadShapefile(map,zipPath,options)},self.loadShapefile=function(map,zipPath,options){shp(zipPath).then(function(geojson){geoj=geojson.features,console.log(geoj[0]);var stateCheck=geoj[0].properties.STATE;if(stateCheck)for(var i in geoj)stateCheck=geoj[i].properties.STATE,"CA"!=stateCheck&&(geoj[i]=void 0);var geoj=geoj.filter(function(val){return val}),featuresLayer=L.geoJSON(geoj,{style:options.backgroundOverlayStyle,onEachFeature:function(feature,layer){options.popupContent&&self.onEachFeature(feature,layer,options.popupContent,options.customFeatureCallback)}});map.addLayer(featuresLayer),options.searchKey&&self.addSearchControls(map,options.searchKey,featuresLayer),options.addDrawingOptions&&self.addDrawControls(map,featuresLayer)})},self.genGuid=function(){var date=(new Date).getTime(),uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(char){var rand=(date+16*Math.random())%16|0;return date=Math.floor(date/16),("x"==char?rand:3&rand|8).toString(16)});return uuid},self.downloadFile=function(url,payload,callback){var xhr=new XMLHttpRequest;xhr.open("POST",url,!0),xhr.responseType="arraybuffer",xhr.onload=function(){if(200===this.status){var filename="";filename=payload.outputName?payload.outputName:self.genGuid(),filename.indexOf(!1)&&(filename+=".zip");var type=xhr.getResponseHeader("Content-Type"),blob=new Blob([this.response],{type:type});if("undefined"!=typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(blob,filename);else{var URL=window.URL||window.webkitURL,downloadUrl=URL.createObjectURL(blob);if(filename){var atag=document.createElement("a");"undefined"==typeof atag.download?window.location=downloadUrl:(atag.href=downloadUrl,atag.download=filename,document.body.appendChild(atag),atag.click())}else window.location=downloadUrl;setTimeout(function(){URL.revokeObjectURL(downloadUrl)},100),callback&&callback()}}},xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhr.send($.param(payload))},self.onEachFeature=function(feature,layer,popupContent,customFeatureCallback){var props=feature.properties;customFeatureCallback&&customFeatureCallback(feature,layer);var template=popupContent,keys=template.match(/[^{]+(?=\}})/g);if(keys.length>0)for(var k in keys){var key=keys[k];template=template.replace("{{"+key+"}}",props[key])}feature.properties&&feature.properties.popupContent&&(template+=feature.properties.popupContent),layer.bindPopup(template)},self.addDrawControls=function(map,featuresLayer){var drawnItems=new L.FeatureGroup;map.addLayer(drawnItems);var drawControl=new L.Control.Draw({position:"topright",draw:{polyline:!0,polygon:!0,circle:!1,marker:!0},edit:{featureGroup:drawnItems,remove:!0}});map.addControl(drawControl),map.on(L.Draw.Event.CREATED,function(e){var layer=(e.layerType,e.layer);drawnItems.addLayer(layer)}),map.on(L.Draw.Event.EDITED,function(e){var layers=e.layers,countOfEditedLayers=0;layers.eachLayer(function(layer){countOfEditedLayers++});var data=featuresLayer.toGeoJSON();if(data=JSON.stringify(data),filename=$("#js-fileName").val(),console.log(filename),payload={json:data,outputName:filename},progressBar=$("#js-map-progress-bar"),doneProcessing=null,progressBar){var percentVal=0,interval=setInterval(function(){100>=percentVal?(progressBar.css("width",percentVal+"%").attr("aria-valuenow",percentVal),percentVal+=.5,percentVal=Math.round(percentVal)):percentVal>100&&(percentVal=0)},50);doneProcessing=function(){clearInterval(interval),progressBar.css("width","0%").attr("aria-valuenow",0),console.log("test callback")}}self.downloadFile(CONVERTER_URL,payload,doneProcessing)})},self.addSearchControls=function(map,searchKey,featuresLayer){var searchControl=new L.Control.Search({layer:featuresLayer,propertyName:searchKey,marker:!1,moveToLocation:function(latlng,title,map){var zoom=map.getBoundsZoom(latlng.layer.getBounds());map.setView(latlng,zoom)}});searchControl.on("search:locationfound",function(e){e.layer.setStyle({fillColor:"#3f0",color:"#0f0"}),e.layer._popup&&e.layer.openPopup()}).on("search:collapsed",function(e){featuresLayer.eachLayer(function(layer){featuresLayer.resetStyle(layer)})}),map.addControl(searchControl)}})}(),function(){function config($stateProvider){$stateProvider.state("login",{url:"/login",templateUrl:"components/account/login.html",data:{pageTitle:"Login",specialClass:"gray-bg"}}).state("forgot_password",{url:"/forgot_password",templateUrl:"components/account/forgot.password.html",data:{pageTitle:"Forgot password",specialClass:"gray-bg"}}).state("register",{url:"/register",templateUrl:"components/account/register.html",data:{pageTitle:"Register",specialClass:"gray-bg"}})}angular.module("app").config(["$stateProvider",config])}(),function(){function config($stateProvider,$urlRouterProvider){$stateProvider.state("index.dashboard",{controller:"DashboardCtrl",controllerAs:"dashboard",data:{pageTitle:"Chart.js"},resolve:{loadPlugin:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load([{files:["js/plugins/chartJs/Chart.min.js"]},{name:"angles",files:["js/plugins/chartJs/angles.js"]},{serie:!0,name:"angular-flot",files:["js/plugins/flot/jquery.flot.js","js/plugins/flot/jquery.flot.time.js","js/plugins/flot/jquery.flot.tooltip.min.js","js/plugins/flot/jquery.flot.spline.js","js/plugins/flot/jquery.flot.resize.js","js/plugins/flot/jquery.flot.pie.js","js/plugins/flot/curvedLines.js","js/plugins/flot/angular-flot.js"]},{serie:!0,files:["js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js","js/plugins/jvectormap/jquery-jvectormap-2.0.2.css"]},{serie:!0,files:["js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"]},{name:"ui.checkbox",files:["js/bootstrap/angular-bootstrap-checkbox.js"]}])}]},templateUrl:"components/dashboard/dashboard.html",url:"/dashboard"})}angular.module("app").config(["$stateProvider","$urlRouterProvider",config])}(),function(){angular.module("app").controller("DashboardCtrl",["$http","$scope","mapservice","$q",function($http,$scope,mapservice,$q){function gd(year,month,day){return new Date(year,month-1,day).getTime()}var vm=this;this.getpriorityMap=function(){var mapBackground={weight:2,opacity:.65},popupTemplate="<p>BAS_SBBSN:  {{BAS_SBBSN}} <br>DWR_Region: {{DWR_Region}} <br>Priority: {{Priority}} <br>Detailed Report: <a target='_blank' href='{{URL}}'>link <br></p>",featureCallBack=function(feature,layer){var feat=feature.properties,options={};switch(feat.Priority){case"Low":options.color="green";break;case"Very Low":options.color="blue";break;case"Medium":options.color="yellow";break;case"High":options.color="orange";break;case"Very High":options.color="red"}layer.setStyle(options)};this.countymap=mapservice.generateMap("js-gwpriority-map",7,"data/CASGEM_Groundwater_Basin_Prioritization.zip",mapBackground,popupTemplate,"BAS_SBBSN",!1,featureCallBack)},this.getpriorityMap(),this.getCountyMap=function(){var mapBackground={color:"green",weight:2,opacity:.65},popupTemplate="<p>ABBREV:  {{ABBREV}} <br>ABCODE: {{ABCODE}} <br>FM Name: {{FMNAME_PC}} <br>NAME_PCASE: {{NAME_PCASE}} <br></p>";this.countymap=mapservice.generateMap("js-county-map",7,"data/County_Boundary.zip",mapBackground,popupTemplate,"NAME_PCASE",!1)},this.getCountyMap(),this.getAquaiferMap=function(){var mapBackground={color:"#A9A9A9",weight:2,opacity:.65},popupTemplate="<p>AQ CODE:  {{AQ_CODE}} <br>AQ NAME: {{AQ_NAME}} <br>ROCK NAME: {{ROCK_NAME}} <br>ROCK TYPE: {{ROCK_TYPE}} <br></p>";this.aquifersmap=mapservice.generateMap("js-aquifers-map",7,"data/aquifers.zip",mapBackground,popupTemplate,"AQ_CODE",!1)},this.getAquaiferMap(),this.getBasinMap=function(){var background={weight:2,opacity:.65},popupContent="<p>Basin ID: {{Basin_ID}} <br>Basin Name: {{Basin_Name}} <br>Basin_Su_1: {{Basin_Su_1}} <br>Region:  {{Region_Off}} <br>Report: {{Report}} <br></p>";this.basinsmap=mapservice.generateMap("js-basin-map",8,"data/B118CAGroundwaterBasins.zip",background,popupContent,"Basin_Su_1",!0)},this.getBasinMap(),this.getWellMap=function(){var mapBackground={color:"#A9A9A9",weight:2,opacity:.65},popupTemplate="<p>Site ID: <a target='_blank' href='https://groundwaterwatch.usgs.gov/AWLSites.asp?mt=g&S={{SITEID}}&ncd=awl'>{{SITEID}}</a> <br>County: {{COUNTY_NM}} {{STATE}} <br>Date: {{DATA_DATE}} <br>Percentile: {{PERCENTILE}} <br>Water level: {{DATA_VAL}}\" {{VERT_DATUM}} <br>Station:  {{SITEID}} <br>Station Number: {{STATION_NM}} <br></p>";this.wellmap=mapservice.generateMap("js-well-map",7,"data/rtn_wells.zip",mapBackground,popupTemplate,null,!1)},this.getWellMap(),vm.flotData=[{label:"",grow:{stepMode:"linear"},data:[[gd(2012,1,1),7],[gd(2012,1,2),6],[gd(2012,1,3),4],[gd(2012,1,4),8],[gd(2012,1,5),9],[gd(2012,1,6),7],[gd(2012,1,7),5],[gd(2012,1,8),4],[gd(2012,1,9),7],[gd(2012,1,10),8],[gd(2012,1,11),9],[gd(2012,1,12),6],[gd(2012,1,13),4],[gd(2012,1,14),5],[gd(2012,1,15),11],[gd(2012,1,16),8],[gd(2012,1,17),8],[gd(2012,1,18),11],[gd(2012,1,19),11],[gd(2012,1,20),6],[gd(2012,1,21),6],[gd(2012,1,22),8],[gd(2012,1,23),11],[gd(2012,1,24),13],[gd(2012,1,25),7],[gd(2012,1,26),9],[gd(2012,1,27),9],[gd(2012,1,28),8],[gd(2012,1,29),5],[gd(2012,1,30),8],[gd(2012,1,31),25]],yaxis:2,color:"#0094FD",lines:{lineWidth:1,show:!0,fill:!0,fillColor:{colors:[{opacity:.2},{opacity:.2}]}}}],vm.flotOptions={grid:{hoverable:!0,clickable:!0,tickColor:"#d5d5d5",borderWidth:0,color:"#d5d5d5"},colors:["#1ab394","#464f88"],tooltip:!0,xaxis:{mode:"time",tickSize:[3,"day"],tickLength:0,axisLabel:"Date",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Arial",axisLabelPadding:10,color:"#d5d5d5"},yaxes:[{position:"left",max:1070,color:"#d5d5d5",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Arial",axisLabelPadding:3},{position:"right",color:"#d5d5d5",axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Arial",axisLabelPadding:67}],legend:{noColumns:1,labelBoxBorderColor:"#d5d5d5",position:"nw"}},vm.barOptions={scaleBeginAtZero:!0,scaleShowGridLines:!1,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1},vm.barData={labels:["01","02","03","04","05","06","07"],datasets:[{label:"My First dataset",fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:[65,59,80,81,56,55,40]},{label:"My Second dataset",fillColor:"rgba(26,179,148,0.5)",strokeColor:"rgba(26,179,148,0.8)",highlightFill:"rgba(26,179,148,0.75)",highlightStroke:"rgba(26,179,148,1)",data:[28,48,40,19,86,27,90]}]},vm.doughnutData=[{value:300,color:"#a3e1d4",highlight:"#1ab394",label:"App"},{value:50,color:"#dedede",highlight:"#1ab394",label:"Software"},{value:100,color:"#A4CEE8",highlight:"#1ab394",label:"Laptop"}],vm.doughnutOptions={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:45,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1},vm.notices=[{name:"District No. 3",basin:"Modesto",basinNumber:73430,manager:"Cecilia Herrera",email:"mante.kylie@yahoo.com",date:"11-06-2017",numbers:"63"},{name:"District No. 32",basin:"Modesto",basinNumber:37675,manager:"Bobby Park",email:"estevan.beatty@gmail.com",date:"03-20-2017",numbers:"40"},{name:"District No. 78",basin:"Turlock",basinNumber:35950,manager:"Isaac Colon",email:"lefler_janice@stark.tv",date:"06-06-2017",numbers:"9"},{name:"District No. 56",basin:"Merced",basinNumber:7817,manager:"Charlier Miller",email:"cronin_karl@yahoo.com",date:"05-20-2017",numbers:"55"}]}])}(),function(){function config($stateProvider){$stateProvider.state("index.basinmapper",{controller:"MapCtrl",controllerAs:"map",url:"/basinmapper",templateUrl:"components/mapper/map.html",data:{pageTitle:"Maps"}})}angular.module("app").config(["$stateProvider",config])}(),function(){function Ctrl($http,$scope,mapservice){var background={weight:2,opacity:.65},popupContent="<p>Basin ID: {{Basin}} <br>GSA filing: <a href='http://sgma.water.ca.gov/portal/gsa/print/{{DWR GSA ID}}' target='_blank'>View</a> <br>GSA Name:  <a target='_blank' href ='{{GSA URL}} '>{{GSA Name}}  </a><br>POC Name: {{POC Name}} <br>POC Email: {{POC Email}} <br>POC Phone: {{POC Phone}} <br>Posted DT:  {{Posted DT}} <br>Local ID: {{Local ID}} <br></p>";this.basinsmap=mapservice.generateMap("map",8,"data/ExclusiveGsaMasterSet.zip",background,popupContent,"Basin_Su_1",!0)}angular.module("app").controller("MapCtrl",["$http","$scope","mapservice",Ctrl])}();